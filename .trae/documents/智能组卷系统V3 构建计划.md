## 目标与约束

* 严格按两份文档实现“智能组卷系统V3”（前后端分离：Vue 前端 + Flask REST API 后端）。

* 数据库使用 MySQL 既有库 exam\_system-v3 的 11 张表；不修改既有表结构与约束。

* AI 采用 DeepSeek（测试阶段允许 API Key 显式存储）。

## 总体结构（仓库根目录）

* backend/：Flask 后端（API、业务服务、MySQL 访问、AI 集成、导入导出、文件上传解析）

* frontend/：Vue3 前端（Element Plus），承载题库/教材/AI校验/组卷/试卷编辑/答题卡配置等页面

* docs/：接口文档、组卷策略 JSON 规范、模板文件（Excel/Word 导入模板、导出模板说明）

## 后端（Flask）实现规划

### 1) 基础工程与配置

* 创建 Flask 应用工厂、蓝图分模块路由、统一错误响应、CORS。

* 配置项：MySQL 连接（host/db/user/pwd）、DeepSeek API Key（默认在 config.py 显式写入，同时支持环境变量覆盖）。

### 2) 数据访问层（对齐 11 表）

* 使用 SQLAlchemy（或等价 ORM/SQL 工具）映射/反射既有表：subject\_dict、question\_type\_dict、question\_difficulty\_dict、textbook、textbook\_chapter、question\_bank、exam\_paper、paper\_question\_relation、exam\_answer\_sheet、answer\_area\_style、sheet\_question\_relation。

* 不做迁移/建表；仅做 CRUD 与查询。

### 3) “待校验题”落地策略（兼容文档与既有表）

* 启动时自动探测 question\_bank 是否存在可表示校验状态的列（如 verify\_status/is\_verified 等）；若存在则使用该列。

* 若不存在，则用“应用层状态约定”实现：AI 生成题写入 question\_bank，但标记为 pending（例如 create\_user=AI\_PENDING），组卷/题库默认查询排除 pending/rejected；通过校验后改为真实创建人或 AI\_APPROVED；拒绝则置为 AI\_REJECTED 或直接软移除（不破坏外键）。

### 4) 业务模块与 API 设计（REST）

* 字典：科目/题型/难度列表接口。

* 教材管理：教材 CRUD、章节树 CRUD/查询、教材文件上传解析（PDF/Word）与章节概要生成（AI）。

* 题库管理：题目 CRUD、组合条件检索；Excel/Word 模板批量导入（解析题干/选项/答案/解析/分值）。

* AI 出题与更新闭环：

  * 生成：按“章节概要 + 既有题目”构建上下文，调用 DeepSeek，生成题落库为 pending。

  * 待校验列表：分页检索 pending。

  * 校验：通过/修改后通过/拒绝。

* 智能组卷：接收“组卷策略 JSON”，按策略转查询条件，多轮随机抽题满足分布；严格保证只从“已校验题库”抽题，不动态生成新题。

* 试卷与导出：试卷 CRUD、试卷题目关系维护（排序/分值）、导出 Word/PDF。

  * Word：基于模板生成（python-docx）。

  * PDF：优先提供可行的转换方案（Windows 环境可选 docx2pdf；否则提供直接 PDF 生成的备选实现或仅交付 Word 并保留扩展点）。

  * 导出版本存档：每次导出在服务器侧保存版本元数据与文件（并提供版本列表与下载/回溯接口）。

* 答题卡：答题卡主表 CRUD、样式库 CRUD（JSON）、答题卡题目-样式绑定与排序维护。

### 5) 导入/解析与导出

* Excel 导入：openpyxl/pandas 解析固定模板字段。

* Word 导入：python-docx 解析固定格式（标题、选项、答案、解析、分值）。

* PDF/Word 教材解析：提取目录/标题层级生成章节树；若解析不稳定则提供“Excel 章节批量录入”作为主路径。

### 6) 质量保障

* 提供最小可运行的集成测试（API 冒烟：字典/教材/题库/组卷/导出/校验）。

* 提供数据库连接自检与约束错误的可读化返回（外键/唯一约束冲突）。

## 前端（Vue3 + Element Plus）实现规划

* 路由与布局：登录/主页导航（可先无鉴权，聚焦业务）。

* 页面模块：

  * 题库：题目列表筛选、详情/编辑、导入（上传 Excel/Word）、手工录入。

  * 教材：教材列表、上传、章节树维护、章节概要查看/生成。

  * AI 校验：生成配置页、pending 列表、单题校验（通过/编辑通过/拒绝）。

  * 组卷：策略编辑器（JSON 编辑 + 基础表单辅助）、生成结果预览、保存为试卷。

  * 试卷：试卷详情、题目排序/分值调整、导出与版本列表。

  * 答题卡：样式库管理、答题卡配置与预览。

## 交付顺序（确保每步可运行）

1. 初始化后端/前端工程骨架与运行脚本，打通本地 MySQL 连接与基础字典查询。
2. 教材管理与章节树 + 题库 CRUD + 条件检索。
3. 批量导入（Excel/Word）与教材章节概要生成（AI）。
4. AI 生成题 + 待校验池 + 校验流程（兼容无状态列的情况）。
5. 组卷策略 JSON 校验与抽题算法 + 试卷保存。
6. 试卷编辑 + Word 导出 + 版本存档；补充 PDF 输出方案。
7. 答题卡与样式配置全链路。

## 关键产出物

* 清晰的目录结构（backend/frontend/docs）与可运行的本地开发环境。

* 完整 REST API（含组卷策略 JSON 规范）与对应前端页面。

* 严格遵守“只从题库抽题、AI 题必须校验后才可用、导出版本可回溯、11 表不改结构”的业务约束。

